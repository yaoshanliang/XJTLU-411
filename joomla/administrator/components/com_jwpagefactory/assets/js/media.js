!function(e){var a,d;e(document).on("click",".jw-pagefactory-btn-media-manager",function(a){a.preventDefault(),$this=e(this),e.ajax({type:"POST",url:pagefactory_base+"index.php?option=com_jwpagefactory&view=media&layout=modal&format=json",data:{support:$this.attr("data-support"),type:$this.attr("data-support"),target:$this.prev().attr("id")},beforeSend:function(){$this.find(".fa").show()},success:function(a){$this.find(".fa").hide(),e(a).show().appendTo(e("body").addClass("jw-pagefactory-media-modal-open")),e(".jw-pagefactory-media-toolbar select").chosen()}})}),e(document).on("click",".jw-pagefactory-btn-close-modal",function(a){a.preventDefault(),e(".jw-pagefactory-media-modal-overlay").remove(),e("body").removeClass("jw-pagefactory-media-modal-open")}),e.fn.browseMedia=function(a){a=e.extend({type:"*",search:"",date:"",start:0,filter:!0,categories:!1,support:"image"},a);e.ajax({type:"POST",url:pagefactory_base+"index.php?option=com_jwpagefactory&view=media&layout=browse&format=json",data:{type:a.type,date:a.date,start:a.start,search:a.search,categories:a.categories,support:a.support},beforeSend:function(){e("#jw-pagefactory-media-loadmore").hide(),e(".jw-pagefactory-media").remove(),e("#jw-pagefactory-cancel-media").parent().hide(),e(".jw-pagefactory-media-wrapper").addClass("jw-pagefactory-media-pre-loading").prepend(e('<div class="jw-pagefactory-loading"><i class="pbfont pbfont-pagefactory"></i></div>'))},success:function(i){e(".jw-pagefactory-media-wrapper").removeClass("jw-pagefactory-media-pre-loading"),e(".jw-pagefactory-loading").remove();var d=e.parseJSON(i);e("#jw-pagefactory-media-types").find(".active").find(".fa").removeClass("fa-spin fa-spinner"),a.filter&&e("#jw-pagefactory-media-filter").html(d.date_filter).trigger("liszt:updated").removeAttr().attr("data-type","browse"),a.categories&&(e("#jw-pagefactory-media-types").html(d.media_categories),a.support&&(e("#jw-pagefactory-media-types").find(">li").removeClass("active"),e("#jw-pagefactory-media-types").find(".jw-pagefactory-media-type-"+a.support).addClass("active"))),d.count?e("#jw-pagefactory-media-manager, #jw-pagefactory-media-modal").removeClass("jw-pagefactory-media-manager-empty"):e("#jw-pagefactory-media-manager, #jw-pagefactory-media-modal").addClass("jw-pagefactory-media-manager-empty"),e(".jw-pagefactory-media-wrapper").prepend(d.output),d.loadmore?e("#jw-pagefactory-media-loadmore").removeAttr("style"):e("#jw-pagefactory-media-loadmore").hide()}})},e.fn.browseFolders=function(a){a=e.extend({path:jwpfMediaPath,filter:!0},a);return this.each(function(){e.ajax({url:pagefactory_base+"index.php?option=com_jwpagefactory&view=media&layout=folders&format=json",type:"POST",data:{path:a.path},beforeSend:function(){a.filter&&e("#jw-pagefactory-media-filter").removeAttr().attr("data-type","folders").val(a.path).parent().show(),e("#jw-pagefactory-cancel-media, #jw-pagefactory-delete-media").parent().hide(),e("#jw-pagefactory-media-loadmore").hide(),e(".jw-pagefactory-media").remove(),e(".jw-pagefactory-media-wrapper").addClass("jw-pagefactory-media-pre-loading").prepend(e('<div class="jw-pagefactory-loading"><i class="pbfont pbfont-pagefactory"></i></div>'))},success:function(i){e(".jw-pagefactory-media-wrapper").removeClass("jw-pagefactory-media-pre-loading"),e(".jw-pagefactory-loading").remove(),e("#jw-pagefactory-media-types").find(".active").find(".fa").removeClass("fa-spin fa-spinner");var d=e.parseJSON(i);0!=d.status?(d.count?e("#jw-pagefactory-media-manager, #jw-pagefactory-media-modal").removeClass("jw-pagefactory-media-manager-empty"):e("#jw-pagefactory-media-manager, #jw-pagefactory-media-modal").addClass("jw-pagefactory-media-manager-empty"),a.filter&&e("#jw-pagefactory-media-filter").html(d.folders_tree).trigger("liszt:updated").removeAttr().attr("data-type","folders"),e(".jw-pagefactory-media-wrapper").prepend(d.output)):alert(d.message)}})})},e(document).on("click",".jw-pagefactory-media-to-folder-back",function(a){a.preventDefault(),e(".jw-pagefactory-media-btn-tools").hide(),e(this).browseFolders({path:e(this).data("path")})}),e(document).on("click",".jw-pagefactory-media-to-folder",function(a){a.preventDefault(),e(".jw-pagefactory-media").find(">li.jw-pagefactory-media-item").removeClass("selected"),e(".jw-pagefactory-media").find(">li.jw-pagefactory-media-folder").removeClass("folder-selected"),e(this).closest("li.jw-pagefactory-media-folder").addClass("folder-selected")}),e(document).on("dblclick",".jw-pagefactory-media-to-folder",function(a){a.preventDefault(),e(".jw-pagefactory-media-btn-tools").hide(),e(this).browseFolders({path:e(this).attr("data-path")})}),e.fn.uploadMedia=function(a){a=e.extend({index:"",data:""},a);e.ajax({type:"POST",url:pagefactory_base+"index.php?option=com_jwpagefactory&task=media.upload_media",data:a.data,contentType:!1,cache:!1,processData:!1,beforeSend:function(){var i=e(".jw-pagefactory-media").find(".jw-pagefactory-media-folder:not(.jw-pagefactory-media-to-folder-back)"),d=e(".jw-pagefactory-media").find(".jw-pagefactory-media-to-folder-back"),p=e('<li id="'+a.index+'" class="jw-pagefactory-media-file-loader"><div><div><div><div><div class="jw-pagefactory-media-upload-progress"><div><div class="jw-pagefactory-progress"><div class="jw-pagefactory-progress-bar" style="width: 0%;"></div></div></div></div></div></div></div><span class="jw-pagefactory-media-title"><i class="fa fa-circle-o-notch fa-spin"></i> '+Joomla.JText._("COM_JWPAGEFACTORY_MEDIA_MANAGER_MEDIA_UPLOADING")+"...</span></div></li>");i.length?i.last().after(p):d.length?d.first().after(p):e(".jw-pagefactory-media").prepend(p),e("#jw-pagefactory-media-manager, #jw-pagefactory-media-modal").removeClass("jw-pagefactory-media-manager-empty")},success:function(i){var d=e.parseJSON(i);d.status?e(".jw-pagefactory-media").find("#"+a.index).removeAttr("id").removeClass('jw-pagefactory-media-file-loader"').addClass("jw-pagefactory-media-item").attr("data-id",d.id).attr("data-src",d.src).attr("data-path",d.path).empty().html(d.output):(e(".jw-pagefactory-media").find("#"+a.index).remove(),alert(d.output)),e(".jw-pagefactory-media").find(">li").length?e("#jw-pagefactory-media-manager, #jw-pagefactory-media-modal").removeClass("jw-pagefactory-media-manager-empty"):e("#jw-pagefactory-media-manager, #jw-pagefactory-media-modal").addClass("jw-pagefactory-media-manager-empty")},xhr:function(){return myXhr=e.ajaxSettings.xhr(),myXhr.upload&&myXhr.upload.addEventListener("progress",function(i){e(".jw-pagefactory-media").find("#"+a.index).find(".jw-pagefactory-progress-bar").css("width",Math.floor(i.loaded/i.total*100)+"%").text(Math.floor(i.loaded/i.total*100)+"%")},!1),myXhr}})},e(document).on("keyup","#jw-pagefactory-media-search-input",function(i){if(i.preventDefault(),""!=e(this).val()?e(".jw-pagefactory-clear-search").show():e(".jw-pagefactory-clear-search").hide(),e(this).val()!=a){var p=e(this).val().trim();d&&clearTimeout(d),d=setTimeout(function(){p?e(this).browseMedia({search:p,filter:!0,date:e("#jw-pagefactory-media-filter").val(),type:e("#jw-pagefactory-media-types").find(".active > a").attr("data-type"),support:"all"}):e(this).browseMedia({filter:!0,date:e("#jw-pagefactory-media-filter").val(),type:e("#jw-pagefactory-media-types").find(".active > a").attr("data-type"),support:"all"})},300),a=e(this).val()}}),e(document).on("click",".jw-pagefactory-clear-search",function(a){a.preventDefault(),e("#jw-pagefactory-media-search-input").val("").focus().keyup()}),e(document).on("click","#jw-pagefactory-media-search-input",function(e){e.preventDefault()}),e(document).on("click",".jw-pagefactory-browse-media",function(a){a.preventDefault();var i=e(this);if(e(this).closest("#jw-pagefactory-media-types").children().removeClass("active"),e(this).parent().addClass("active"),e(this).find(".fa").addClass("fa-spinner fa-spin"),e("#jw-pagefactory-upload-media").parent().show(),"folders"==i.attr("data-type"))e(".jw-pagefactory-media-search").parent().hide(),e("#jw-pagefactory-media-create-folder").parent().show(),e(this).browseFolders();else{e(".jw-pagefactory-media-search").parent().show(),e("#jw-pagefactory-media-create-folder").parent().hide();var d="all";e("#jw-pagefactory-media-modal").length&&(d=e("#jw-pagefactory-media-modal").data("support")),e(this).browseMedia({type:i.data("type"),support:d,element:i})}}),e(document).on("click","#jw-pagefactory-media-loadmore",function(a){a.preventDefault();var i=e(this),d=e("#jw-pagefactory-media-search-input").val().trim(),p="all";e("#jw-pagefactory-media-modal").length&&(p=e("#jw-pagefactory-media-modal").data("support")),e.ajax({type:"POST",url:pagefactory_base+"index.php?option=com_jwpagefactory&view=media&layout=browse&format=json",data:{search:d,type:e("#jw-pagefactory-media-types").find(".active > a").attr("data-type"),support:p,date:e("#jw-pagefactory-media-filter").val(),start:e(".jw-pagefactory-media").find(">li").length},beforeSend:function(){i.find(".fa").removeClass("fa-refresh").addClass("fa-spinner fa-spin")},success:function(a){try{var d=e.parseJSON(a);i.find(".fa").removeClass("fa-spinner fa-spin").addClass("fa-refresh"),e(".jw-pagefactory-media").append(d.output),d.loadmore?e("#jw-pagefactory-media-loadmore").parent().removeAttr("style"):e("#jw-pagefactory-media-loadmore").parent().hide()}catch(i){e(".jw-pagefactory-media-body-inner").html(a)}}})}),e(document).on("change","#jw-pagefactory-media-filter",function(a){a.preventDefault(),"folders"==e(this).attr("data-type")?e(this).browseFolders({path:e(this).val()}):e(this).browseMedia({filter:!1,date:e(this).val(),type:e("#jw-pagefactory-media-types").find(".active > a").attr("data-type"),support:"all"})}),e(document).on("click",".jw-pagefactory-media > li.jw-pagefactory-media-item",function(a){a.preventDefault();var i=e(this);e(".jw-pagefactory-media").find(">li.jw-pagefactory-media-folder").removeClass("folder-selected"),i.hasClass("jw-pagefactory-media-unsupported")||(null!=e("#jw-pagefactory-media-modal")&&e("#jw-pagefactory-media-modal .jw-pagefactory-media > li.jw-pagefactory-media-item").not(this).each(function(){e(this).removeClass("selected")}),e(this).hasClass("selected")?e(this).removeClass("selected"):e(this).addClass("selected"),e(".jw-pagefactory-media > li.jw-pagefactory-media-item.selected").length?(e("#jw-pagefactory-upload-media, .jw-pagefactory-media-search, #jw-pagefactory-media-filter").parent().hide(),e("#jw-pagefactory-cancel-media, #jw-pagefactory-delete-media").parent().show()):(e("#jw-pagefactory-cancel-media, #jw-pagefactory-delete-media").parent().hide(),e("#jw-pagefactory-upload-media, .jw-pagefactory-media-search, #jw-pagefactory-media-filter").parent().show()))}),e(document).on("click","#jw-pagefactory-insert-media",function(a){a.preventDefault();var i=e("#jw-pagefactory-media-modal").attr("data-support"),d=e("#"+e("#jw-pagefactory-media-modal").attr("data-target"));"image"==i&&d.prev(".jw-pagefactory-media-preview").removeClass("jw-pagefactory-media-no-image").attr("src",e(".jw-pagefactory-media > li.jw-pagefactory-media-item.selected").data("src")),d.val(e(".jw-pagefactory-media > li.jw-pagefactory-media-item.selected").data("path")),d.trigger("change"),e(".jw-pagefactory-media-modal-overlay").remove(),e("body").removeClass("jw-pagefactory-media-modal-open")}),e(document).on("click",".jw-pagefactory-btn-clear-media",function(a){a.preventDefault();var i=e(this);i.siblings(".jw-pagefactory-media-preview").addClass("jw-pagefactory-media-no-image").removeAttr("src"),i.siblings("input").val(""),i.siblings("input").trigger("change")}),e(document).on("click","#jw-pagefactory-cancel-media",function(a){a.preventDefault(),e(".jw-pagefactory-media > li.jw-pagefactory-media-item.selected").removeClass("selected"),e("#jw-pagefactory-cancel-media, #jw-pagefactory-delete-media").parent().hide(),e("#jw-pagefactory-upload-media, .jw-pagefactory-media-search, #jw-pagefactory-media-filter").parent().show(),"browse"==e("#jw-pagefactory-media-filter").attr("data-type")?e(".jw-pagefactory-media-search").parent().show():e(".jw-pagefactory-media-search").parent().hide()}),e(document).on("click","#jw-pagefactory-upload-media, #jw-pagefactory-upload-media-empty",function(a){a.preventDefault(),e("#jw-pagefactory-media-input-file").click()}),e(document).on("change","#jw-pagefactory-media-input-file",function(a){a.preventDefault();var d=e(this),p=e(this).prop("files"),r=new FormData;for(i=0;i<p.length;i++)r.append("file",p[i]),"folders"==e("#jw-pagefactory-media-filter").attr("data-type")&&null!=e("#jw-pagefactory-media-filter").val()&&r.append("folder",e("#jw-pagefactory-media-filter").val()),e(this).uploadMedia({data:r,index:"media-id-"+Math.floor(1e6*Math.random()+1)});d.val("")}),e(document).on("dragenter","#jw-pagefactory-media-manager",function(a){a.preventDefault(),a.stopPropagation(),e(this).addClass("jw-pagefactory-media-drop")}),e(document).on("mouseleave","#jw-pagefactory-media-manager",function(a){a.preventDefault(),a.stopPropagation(),e(this).removeClass("jw-pagefactory-media-drop")}),e(document).on("dragover","#jw-pagefactory-media-manager",function(e){e.preventDefault()}),e(document).on("drop","#jw-pagefactory-media-manager",function(a){a.preventDefault(),a.stopPropagation(),e(this).removeClass("jw-pagefactory-media-drop");var d=a.originalEvent.dataTransfer.files;for(i=0;i<d.length;i++){var p=new FormData;p.append("file",d[i]),"folders"==e("#jw-pagefactory-media-filter").attr("data-type")&&null!=e("#jw-pagefactory-media-filter").val()&&p.append("folder",e("#jw-pagefactory-media-filter").val()),e(this).uploadMedia({data:p,index:"media-id-"+Math.floor(1e6*Math.random()+1)})}}),e(document).on("click","#jw-pagefactory-delete-media",function(a){a.preventDefault();e(this);var i=e(".jw-pagefactory-media").find("li.jw-pagefactory-media-item.selected");1==confirm(Joomla.JText._("COM_JWPAGEFACTORY_MEDIA_MANAGER_CONFIRM_DELETE"))&&i.each(function(a,d){var p={};p=void 0!==e(d).data("id")?{m_type:"id",id:e(d).data("id")}:{m_type:"path",path:e(d).data("path")},e.ajax({type:"POST",url:pagefactory_base+"index.php?option=com_jwpagefactory&task=media.delete_media",data:p,success:function(a){var d=e.parseJSON(a);d.status?(i.remove(),e("#jw-pagefactory-cancel-media, #jw-pagefactory-delete-media").parent().hide(),e("#jw-pagefactory-upload-media, .jw-pagefactory-media-search, #jw-pagefactory-media-filter").parent().show()):alert(d.output)}})})}),e(document).on("click","#jw-pagefactory-media-create-folder",function(a){a.preventDefault();e(this);var i="/"+jwpfMediaPath;null!=e("#jw-pagefactory-media-filter").val()&&"folders"==e("#jw-pagefactory-media-filter").attr("data-type")&&(i=e("#jw-pagefactory-media-filter").val());var d=prompt(Joomla.JText._("COM_JWPAGEFACTORY_MEDIA_MANAGER_ENTER_DIRECTORY_NAME"));null!=d&&e.ajax({type:"POST",url:pagefactory_base+"index.php?option=com_jwpagefactory&task=media.create_folder",data:{folder:i+"/"+d},success:function(a){try{var i=e.parseJSON(a);if(i.status){var d=e(".jw-pagefactory-media").find(".jw-pagefactory-media-folder:not(.jw-pagefactory-media-to-folder-back)"),p='<li class="jw-pagefactory-media-folder jw-pagefactory-media-to-folder" data-path="'+i.output.relname+'"><div><div><div><div><div><div><i class="fa fa-folder"></i></div></div></div></div></div><span class="jw-pagefactory-media-title">'+i.output.name+"</span></div></li>";d.length?d.first().before(p):e(".jw-pagefactory-media").append(p)}else alert(i.output)}catch(i){e(".jw-pagefactory-media-body-inner").html(a)}}})})}(jQuery);